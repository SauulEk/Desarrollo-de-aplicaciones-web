<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Documentación API - DynaDoc</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 900px;
            margin: 0 auto;
            padding: 40px;
            background-color: #fff;
        }

        h1 {
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }

        h2 {
            color: #2980b9;
            margin-top: 40px;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
            page-break-after: avoid;
        }

        h3 {
            color: #16a085;
            margin-top: 30px;
            page-break-after: avoid;
        }

        .endpoint-container {
            margin-bottom: 30px;
            page-break-inside: avoid;
            /* Evita que se corte al imprimir */
        }

        .endpoint {
            background-color: #f8f9fa;
            border-left: 5px solid #3498db;
            padding: 10px 20px;
            margin: 10px 0;
            font-family: 'Consolas', 'Monaco', monospace;
            color: #e74c3c;
            font-weight: bold;
        }

        .badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 4px;
            color: white;
            font-size: 0.8em;
            margin-right: 10px;
            vertical-align: middle;
        }

        .post {
            background-color: #49cc90;
        }

        .get {
            background-color: #61affe;
        }

        .put {
            background-color: #fca130;
        }

        .delete {
            background-color: #f93e3e;
        }

        .code-block {
            background-color: #282c34;
            color: #abb2bf;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            font-size: 0.85em;
            margin-top: 5px;
            margin-bottom: 15px;
            position: relative;
        }

        .code-label {
            font-size: 0.75em;
            text-transform: uppercase;
            color: #aaa;
            margin-bottom: 5px;
            display: block;
            font-weight: bold;
            border-bottom: 1px solid #444;
            padding-bottom: 2px;
        }

        .js-keyword {
            color: #c678dd;
        }

        /* purple */
        .js-string {
            color: #98c379;
        }

        /* green */
        .js-func {
            color: #61afef;
        }

        /* blue */

        code {
            font-family: 'Consolas', 'Monaco', monospace;
        }

        .note {
            background-color: #fff3cd;
            border: 1px solid #ffeeba;
            color: #856404;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
    </style>
</head>

<body>

    <h1>Documentación de API - DynaDoc</h1>
    <p><strong>Base URL:</strong> <code>http://localhost:5116</code></p>
    <p><strong>Formato:</strong> JSON</p>
    <p>Guía de integración para Frontend (cURL y JavaScript).</p>

    <h2>1. Autenticación</h2>

    <div class="endpoint-container">
        <h3>Registro de Usuario</h3>
        <p>Recibe el usuario y la contraseña y crea una cuenta.</p>
        <div class="endpoint"><span class="badge post">POST</span> /api/auth/register</div>

        <div class="code-block">
            <span class="code-label">cURL</span>
            curl -X POST http://localhost:5116/api/auth/register \
            -H "Content-Type: application/json" \
            -d '{"Username": "testuser", "Password": "mypassword"}'
        </div>

        <div class="code-block">
            <span class="code-label">JavaScript (Fetch)</span>
            <pre style="margin:0"><code><span class="js-keyword">const</span> registerUser = <span class="js-keyword">async</span> () => {
  <span class="js-keyword">const</span> res = <span class="js-keyword">await</span> fetch(<span class="js-string">'http://localhost:5116/api/auth/register'</span>, {
    method: <span class="js-string">'POST'</span>,
    headers: { <span class="js-string">'Content-Type'</span>: <span class="js-string">'application/json'</span> },
    body: JSON.stringify({ Username: <span class="js-string">"testuser"</span>, Password: <span class="js-string">"mypassword"</span> })
  });
  <span class="js-keyword">const</span> data = <span class="js-keyword">await</span> res.json();
  console.log(data);
};</code></pre>
        </div>
    </div>

    <div class="endpoint-container">
        <h3>Iniciar Sesión</h3>
        <p>Recibe un usuario y una contraseña, los valida, y devuelve el ID del usuario y una llave JWT que se deben
            almacenar en localstorage.</p>
        <div class="endpoint"><span class="badge post">POST</span> /api/auth/login</div>

        <div class="code-block">
            <span class="code-label">cURL</span>
            curl -X POST http://localhost:5116/api/auth/login \
            -H "Content-Type: application/json" \
            -d '{"Username": "testuser", "Password": "mypassword"}'
        </div>

        <div class="code-block">
            <span class="code-label">JavaScript (Fetch)</span>
            <pre style="margin:0"><code><span class="js-keyword">const</span> login = <span class="js-keyword">async</span> () => {
  <span class="js-keyword">const</span> res = <span class="js-keyword">await</span> fetch(<span class="js-string">'http://localhost:5116/api/auth/login'</span>, {
    method: <span class="js-string">'POST'</span>,
    headers: { <span class="js-string">'Content-Type'</span>: <span class="js-string">'application/json'</span> },
    body: JSON.stringify({ Username: <span class="js-string">"testuser"</span>, Password: <span class="js-string">"mypassword"</span> })
  });
  <span class="js-keyword">const</span> data = <span class="js-keyword">await</span> res.json();
  <span class="js-keyword">return</span> data; <span class="js-comment">// Guarda el token o ID si aplica</span>
};</code></pre>
        </div>
    </div>

    <h2>2. Gestión de Currículums (CRUD)</h2>

    <p>Todos los endpoints de curriculum requieren un header de autenticación:</p>
    <code>Authorization: Bearer {token va aquí}</code>

    <div class="endpoint-container">
        <h3>Crear un nuevo CV</h3>
        <p>Recibe un body con este formato json:</p>
        <code><pre>{
     "templateId": 1,
     "userId": 1,
     "nombre": "Maria Garcia",
     "ocupacion": "Arquitecta de Software",
     "email": "maria@example.com",
     "telefono": "999-999-9999",
     "direccion": "Merida, Centro",
     "educacion": [
       {
         "institucion": "Tecnologico de Merida",
         "fecha_Graduacion": "2022",
         "carrera": "Ingenieria en Sistemas"
       },
       {
        //...mas educaciones
       }
     ],
     "trabajo": [
       {
         "empresa": "Google",
         "fecha_Inicio": "2022",
         "fecha_Final": "Presente",
         "puesto": "Backend Dev"
       },
       {
        //...mas trabajos
       }
     ],
     "habilidades": [
       { "habilidad": ".NET 8" },
       { "habilidad": "Azure" },
       {
        //...mas habilidades
       }
     ],
     "intereses": [
       { "interes": "Robotica" },
       {
        //...mas intereses
       }
     ]
   }</pre></code>
        <div class="endpoint"><span class="badge post">POST</span> /api/cv</div>

        <div class="code-block">
            <span class="code-label">cURL</span>
            curl -X POST http://localhost:5116/api/cv \
            -H "Content-Type: application/json" \
            -d '{ "templateId": 1, "userId": 1, "nombre": "Maria", ... }'
        </div>

        <div class="code-block">
            <span class="code-label">JavaScript (Fetch)</span>
            <pre style="margin:0"><code><span class="js-keyword">const</span> createCv = <span class="js-keyword">async</span> (cvData) => {
  <span class="js-keyword">const</span> res = <span class="js-keyword">await</span> fetch(<span class="js-string">'http://localhost:5116/api/cv'</span>, {
    method: <span class="js-string">'POST'</span>,
    headers: { <span class="js-string">'Content-Type'</span>: <span class="js-string">'application/json'</span> },
    body: JSON.stringify(cvData)
  });
  <span class="js-keyword">if</span> (!res.ok) console.error(<span class="js-string">"Error creando CV"</span>);
  <span class="js-keyword">return</span> <span class="js-keyword">await</span> res.json();
};

<span class="js-comment">// Ejemplo de objeto cvData:</span>
<span class="js-comment">// { templateId: 1, userId: 1, nombre: "Maria", educacion: [], ... }</span></code></pre>
        </div>
    </div>

    <div class="endpoint-container">
        <h3>Obtener todos los CVs</h3>
        <p>Devuelve una lista de los CVs del usuario en formato JSON con la misma estructura que usa el endpoint para
            crear CV.</p>
        <div class="endpoint"><span class="badge get">GET</span> /api/Cv</div>

        <div class="code-block">
            <span class="code-label">JavaScript (Fetch)</span>
            <pre style="margin:0"><code><span class="js-keyword">const</span> getAllCvs = <span class="js-keyword">async</span> () => {
  <span class="js-keyword">const</span> res = <span class="js-keyword">await</span> fetch(<span class="js-string">'http://localhost:5116/api/Cv'</span>);
  <span class="js-keyword">const</span> data = <span class="js-keyword">await</span> res.json();
  console.log(data);
};</code></pre>
        </div>
    </div>

    <div class="endpoint-container">
        <h3>Obtener un CV por ID</h3>
        <p>Si existe y es del usuario, devuelve el CV en formato json con la misma estructura que usa el endpoint para
            crear CV.</p>
        <div class="endpoint"><span class="badge get">GET</span> /api/Cv/{id}</div>

        <div class="code-block">
            <span class="code-label">JavaScript (Fetch)</span>
            <pre style="margin:0"><code><span class="js-keyword">const</span> getCvById = <span class="js-keyword">async</span> (id) => {
  <span class="js-keyword">const</span> res = <span class="js-keyword">await</span> fetch(<span class="js-string">`http://localhost:5116/api/Cv/${id}`</span>);
  <span class="js-keyword">const</span> data = <span class="js-keyword">await</span> res.json();
  <span class="js-keyword">return</span> data;
};</code></pre>
        </div>
    </div>

    <div class="endpoint-container">
        <h3>Actualizar un CV</h3>
        <p>Actualiza el CV si existe y es del usuario. El body proporcionado tiene la misma estructura que usa el
            endpoint para crear CV.</p>
        <p>El ID en la URL debe coincidir con el ID en el cuerpo del JSON.</p>
        <div class="endpoint"><span class="badge put">PUT</span> /api/Cv/{id}</div>

        <div class="code-block">
            <span class="code-label">JavaScript (Fetch)</span>
            <pre style="margin:0"><code><span class="js-keyword">const</span> updateCv = <span class="js-keyword">async</span> (id, updatedData) => {
  <span class="js-keyword">const</span> res = <span class="js-keyword">await</span> fetch(<span class="js-string">`http://localhost:5116/api/Cv/${id}`</span>, {
    method: <span class="js-string">'PUT'</span>,
    headers: { <span class="js-string">'Content-Type'</span>: <span class="js-string">'application/json'</span> },
    body: JSON.stringify(updatedData)
  });
  
  <span class="js-keyword">if</span> (res.status === 204) console.log(<span class="js-string">"Actualizado con éxito"</span>);
};</code></pre>
        </div>
    </div>

    <div class="endpoint-container">
        <h3>Eliminar un CV</h3>
        <p>Elimina el CV si existe y es del usuario.</p>
        <div class="endpoint"><span class="badge delete">DELETE</span> /api/Cv/{id}</div>

        <div class="code-block">
            <span class="code-label">JavaScript (Fetch)</span>
            <pre style="margin:0"><code><span class="js-keyword">const</span> deleteCv = <span class="js-keyword">async</span> (id) => {
  <span class="js-keyword">await</span> fetch(<span class="js-string">`http://localhost:5116/api/Cv/${id}`</span>, {
    method: <span class="js-string">'DELETE'</span>
  });
};</code></pre>
        </div>
    </div>

    <h2>3. Plantillas y PDF</h2>
    <p>Todos los endpoints de pdf requieren un header de autenticación:</p>
    <code>Authorization: Bearer {token va aquí}</code>

    <div class="endpoint-container">
        <h3>Listar Plantillas</h3>
        <p>Devuelve una lista de las plantillas con este formato json:</p>
        <code><pre>
            [{
                "id": "1",
                "name": "plantilla interesante",
                "content": "codigo html para generar plantilla"
            },
            {
                //... Mas plantillas
            }]
        </pre></code>
        <div class="endpoint"><span class="badge get">GET</span> /api/pdf/list</div>

        <div class="code-block">
            <span class="code-label">JavaScript (Fetch)</span>
            <pre style="margin:0"><code><span class="js-keyword">const</span> getTemplates = <span class="js-keyword">async</span> () => {
  <span class="js-keyword">const</span> res = <span class="js-keyword">await</span> fetch(<span class="js-string">'http://localhost:5116/api/pdf/list'</span>);
  <span class="js-keyword">return</span> <span class="js-keyword">await</span> res.json();
};</code></pre>
        </div>
    </div>

    <div class="endpoint-container">
        <h3>Generar y Descargar PDF</h3>
        <p>Este endpoint recibe un id de curriculum en la URL y devuelve un archivo binario (Blob). Requiere un manejo
            especial en JS para decirle al navegador que es un PDF.</p>
        <div class="endpoint"><span class="badge post">POST</span> /api/pdf/generate/{id}</div>

        <div class="code-block">
            <span class="code-label">cURL</span>
            curl -X POST http://localhost:5116/api/pdf/generate/1 --output cv.pdf
        </div>

        <div class="code-block">
            <span class="code-label">JavaScript (Descarga de Archivo)</span>
            <pre style="margin:0"><code><span class="js-keyword">const</span> downloadPdf = <span class="js-keyword">async</span> (cvId) => {
  <span class="js-keyword">try</span> {
    <span class="js-keyword">const</span> res = <span class="js-keyword">await</span> fetch(<span class="js-string">`http://localhost:5116/api/pdf/generate/${cvId}`</span>, {
      method: <span class="js-string">'POST'</span>
    });

    <span class="js-keyword">if</span> (res.ok) {
      <span class="js-comment">// 1. Convertir respuesta a Blob</span>
      <span class="js-keyword">const</span> blob = <span class="js-keyword">await</span> res.blob();
      
      <span class="js-comment">// 2. Crear URL temporal</span>
      <span class="js-keyword">const</span> url = window.URL.createObjectURL(blob);
      
      <span class="js-comment">// 3. Crear enlace invisible y forzar click</span>
      <span class="js-keyword">const</span> a = document.createElement(<span class="js-string">'a'</span>);
      a.href = url;
      a.download = <span class="js-string">`cv_${cvId}.pdf`</span>;
      document.body.appendChild(a);
      a.click();
      
      <span class="js-comment">// 4. Limpiar</span>
      a.remove();
      window.URL.revokeObjectURL(url);
    }
  } <span class="js-keyword">catch</span> (err) {
    console.error(<span class="js-string">"Error descargando PDF"</span>, err);
  }
};</code></pre>
        </div>
    </div>

    <br>
    <hr>
    <p style="text-align: center; font-size: 0.8em; color: #888;">Generado para el equipo de desarrollo de DynaDoc</p>

</body>

</html>